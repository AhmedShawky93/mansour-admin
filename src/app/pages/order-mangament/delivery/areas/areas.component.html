<ngx-loading-bar [color]="'#4AC356 '"></ngx-loading-bar>
<div class="top-table-bar">

  <div class="row">
    <div class="col-md-8">
      <div class="left-search">
        <span>
          <i class="fa fa-search"></i>
        </span>
        <input type="text" class="owl-input owls-search" placeholder="search ..." [(ngModel)]="searchTerm">
      </div>
    </div>

    <div class="col-md-4 text-right">
      <div class="owl-btn-list">
        <button class="btn btn-owls btn-rounded btn-blue2 btn-big btn-block open-add ml-auto"> + New area</button>
      </div>
    </div>

  </div>
</div>
<!-- <app-loader></app-loader> -->
<div class="table-responsive">
  <table class="table owls-table ">
    <thead>
      <tr>
        <th style="width: 250px" scope="col"> area ID </th>
        <th style="width: 390px" scope="col"> name </th>
        <th scope="col"> city </th>
        <th scope="col"> Delivery Fees </th>
        <th style="text-align: center" scope="col"> action </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let area of areas | stringFilter: searchTerm | paginate: { itemsPerPage: 10, currentPage: p }">
        <td>{{area.id}}</td>
        <td>{{area.name}} </td>
        <td>{{area.city.name}}</td>
        <td>{{area.delivery_fees}}</td>
        <td style="text-align: center">
          <a (click)='editArea(area)' href="javascript:void(0)" class="table-view open-edit">
            <i class="icon-grey"></i>
          </a>
          <label class="switch">
            <input type="checkbox" value="1" [(ngModel)]="area.active" (change)="changeActive(area, $event)">
            <span class="slider round"></span>

            <div class="reason-popup text-left" [hidden]="!area.showReason">
              <textarea name="" class="owl-input" placeholder="Why Do yo want to deactivate this area?" [(ngModel)]="area.notes"></textarea>

              <button class="btn btn-owls btn-rounded btn-green2" [disabled]="!area.notes" (click)="submitDeactivate(area)">submit</button>
              <button class="btn btn-owls btn-rounded btn-blue2 cancel-check" (click)="cancelDeactivate(area)">cancel</button>
            </div>
            <div class="hover-reason text-left" *ngIf="!area.active">
              <div class="head">
                Deactivation Notes
              </div>
              <div class="body">
                {{area.deactivation_notes}}
              </div>
            </div>
          </label>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<pagination-controls (pageChange)="p = $event"></pagination-controls>

<!-- add area side bar -->
<div class="form-sidebar view-vindor-types" id="add-area">
  <div class="head">
    <span class="close" id="close-add-area">
      <i class="icon-Exit"></i>
    </span>
    <h3>new Area</h3>
  </div>
  <div class="add-area-form">

    <form [formGroup]="newArea" (ngSubmit)="addArea(area)" novalidate>


      <div class="form-group">
        <label for="">city</label>
        <select class="owl-input" id="city_id" class="owl-input" [(ngModel)]="area.city_id" placeholder="type here.." name="city_id" required formControlName="city_id">
          <option value="" disabled>Select City</option>
          <option *ngFor="let city of cities" value="{{city.id}}">{{city.name}}</option>
        </select>
        <!-- Errors Rolues -->
        <div *ngIf="newArea.controls.city_id.invalid && (newArea.controls.city_id.dirty || newArea.controls.city_id.touched)" class="alert alert-danger">
          <div *ngIf="newArea.controls.city_id.errors.required">
            City is required.
          </div>
        </div>
        <!-- Errors Rolues -->
      </div>


      <div class="form-group">
        <label for="">area name</label>

        <input type="text" [(ngModel)]="area.name" class="owl-input" placeholder="type here.." name="name" required formControlName="name">

      </div>
      <!-- Errors Rolues -->
      <div *ngIf="newArea.controls.name.invalid && (newArea.controls.name.dirty || newArea.controls.name.touched)" class="alert alert-danger">
        <div *ngIf="newArea.controls.name.errors.required ">
          Name is required.
        </div>
      </div>

      <div class="form-group">
        <label for="">Delivery Fees</label>

        <input type="text" [(ngModel)]="area.delivery_fees" class="owl-input" placeholder="type here.." name="delivery_fees" required min="0" max="500" formControlName="delivery_fees">

      </div>
      <div *ngIf="newArea.controls.delivery_fees.invalid && (newArea.controls.delivery_fees.dirty || newArea.controls.delivery_fees.touched)" class="alert alert-danger">
        <div *ngIf="newArea.controls.delivery_fees.errors.required">
          Delivery Fees is required.
        </div>
        <div *ngIf="newArea.controls.delivery_fees.errors.min">
          Delivery Fees can't be a negative number
        </div>
        <div *ngIf="newArea.controls.delivery_fees.errors.max">
          Delivery Fees can't be more than 500
        </div>
      </div>
      <!-- Errors Rolues -->
      <div class="btn-group">
        <button type="submit" class="btn btn-owls btn-rounded btn-green">add</button>
      </div>
    </form>
  </div>

</div>

<!-- edit area side bar -->
<div class="form-sidebar view-vindor-types" id="edit-area">
  <div class="head">
    <span class="close" id="close-edit-area">
      <i class="icon-Exit"></i>
    </span>
    <h3>Edit Area</h3>
  </div>
  <div class="add-area-form">
    <form #updateForm="ngForm" (ngSubmit)="updateForm.valid && updateArea(currentArea)" novalidate>
      <div class="form-group">
        <label for="">City</label>
        <select class="owl-input" id="" class="owl-input" placeholder="type here.." name="city_edit" [(ngModel)]="currentArea.city_id" #city_edit="ngModel" required>
          <option value="" disabled selected>Select City</option>
          <option *ngFor="let city of cities" value="{{city.id}}">{{city.name}}</option>
        </select>
      </div>
      <!-- Errors Rolues -->
      <div *ngIf="updateForm.submitted &&  city_edit.invalid" class="alert alert-danger">
        <div *ngIf="city_edit.errors.required">
          City is required.
        </div>
      </div>
      <!-- Errors Rolues -->
      <div class="form-group">
        <label for="">area name</label>
        <input type="text" [(ngModel)]="currentArea.name" class="owl-input" placeholder="type here.." name="areaNameEdit" #areaNameEdit="ngModel" required [rangeLength]="[2, 21]">
        <!-- Errors Rolues -->
        <div *ngIf="updateForm.submitted &&  areaNameEdit.invalid" class="alert alert-danger">
          <div *ngIf="areaNameEdit.errors.required">
            Name is required.
          </div>
          <div *ngIf="areaNameEdit.errors.rangeLength">
            is required.
          </div>
        </div>
        <!-- Errors Rolues -->
      </div>

      <div class="form-group">
        <label for="">Delivery Fees</label>
        <input type="text" [(ngModel)]="currentArea.delivery_fees" class="owl-input" placeholder="type here.." name="feesEdit" #feesEdit="ngModel" min="0" max="500" required>
        <!-- Errors Rolues -->
        <div *ngIf="updateForm.submitted &&  feesEdit.invalid" class="alert alert-danger">
          <div *ngIf="feesEdit.errors.required">
            Delivery Fees is required.
          </div>
          <div *ngIf="feesEdit.errors.min">
            Delivery Fees can't be a negative number
          </div>
          <div *ngIf="feesEdit.errors.max">
            Delivery Fees can't be more than 500
          </div>
        </div>
        <!-- Errors Rolues -->
      </div>

      <div class="btn-group">
        <button class="btn btn-owls btn-rounded btn-green" type="submit">Save</button>
        <!-- <button type="button" class="float-right btn
              btn-owls btn-circle btn-remove btn-red2 "
              (click)="getAreaRemove(currentArea.id)"
              data-toggle="modal" data-target="#removePopUp2">
                <i class="fa fa-trash"></i>
              </button> -->
      </div>
    </form>
  </div>
</div>
<!-- Delete Popup for table  -->
<div class="modal fade" id="removePopUp2" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" *ngIf="seclectArea">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">are you sure to delete this item ?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" (click)="removeArea()" class="btn-owls btn-rounded btn-green btn-red2">remove</button>
        <button type="button" data-dismiss="modal" class="btn-owls btn-rounded btn-green btn-blue2">cancel </button>
      </div>
    </div>
  </div>
</div>



<!-- Delete Popup for sidebar  -->
<div class="modal fade" id="removePopUp2" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">are you sure to delete this item ?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-owls btn-rounded btn-green btn-red2">remove</button>
        <button type="button" data-dismiss="modal" class="btn-owls btn-rounded btn-green btn-blue2">cancel </button>
      </div>
    </div>
  </div>
</div>